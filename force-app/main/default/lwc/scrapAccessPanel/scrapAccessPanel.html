<template>
    <div class="access-panel">
        <div class="tab-header">
            <h1 class="tab-title">Доступ постачальників</h1>
            <p class="tab-subtitle">
                У цій вкладці ви керуєте <b>доступом постачальників</b> до видів брухту.
                Використовуйте пошук та масові дії, щоб швидко змінювати налаштування.
                Можна перемикати режим відображення: за видами брухту або за постачальниками.
                Ліворуч оберіть сутність, а у вікні праворуч відкриється список для керування доступами.
                У списку відображаються лише активні позиції. Якщо потрібного виду немає — активуйте його у довіднику.
            </p>
        </div>



        <!-- Spinner -->
        <template if:true={isLoading}>
            <div class="spinner-backdrop">
                <lightning-spinner alternative-text="Завантаження" size="small" variant="brand"></lightning-spinner>
            </div>
        </template>

        <div class="header">
            <div class="title-block">
                <h2 class="title">{headerTitle}</h2>
<!--                <p class="subtitle">-->
<!--                    Керуйте доступом до видів брухту для постачальників або визначайте постачальників, яким доступний конкретний вид. У списку відображаються лише активні позиції. Якщо потрібного виду немає — активуйте його у довіднику.-->
<!--                </p>-->
            </div>

            <div class="actions">
                <!-- Кнопки масової зміни доступів -->
                <template if:true={hasBottomItems}>
                    <button class="mini-btn" onclick={handleSelectAll}>Вибрати всі</button>
                    <button class="mini-btn secondary" onclick={handleClearAll}>Скинути всі</button>
                </template>

                <div class="search">
                    <input type="search"
                           class="search-input"
                           placeholder={searchPlaceholder}
                           value={searchQuery}
                           oninput={handleSearchInput}
                           onfocus={openSearch}
                           onblur={handleSearchBlur}
                           onkeydown={handleSearchKeydown}>
                    <template if:true={showDropdown}>
                        <ul class="search-dropdown" onmousedown={handleDropdownMousedown}>
                            <template if:true={hasSearchResults}>
                                <template for:each={searchResults} for:item="opt">
                                    <li key={opt.id}
                                        class="search-item"
                                        data-id={opt.id}
                                        onclick={handlePickFromSearch}>
                                        {opt.name}
                                    </li>
                                </template>
                            </template>
                            <template if:false={hasSearchResults}>
                                <li class="search-empty">Нічого не знайдено</li>
                            </template>
                        </ul>
                    </template>
                </div>

                <div class="icon-button" onclick={toggleMode} title="Змінити режим">
                    <svg  viewBox="0 0 452.025 452.025" ><path d="M147.912,363.325c-4.7-4.7-12.3-4.7-17,0c-4.7,4.7-4.7,12.3,0,17l13.6,13.6h-55.2c-35.9,0-65-29.2-65-65v-40.3 c0-6.6-5.4-12-12-12s-12,5.4-12,12v40.3c0,49.1,39.9,89,89,89h55.2l-13.6,13.6c-4.7,4.7-4.7,12.3,0,17c2.3,2.3,5.4,3.5,8.5,3.5 s6.1-1.2,8.5-3.5l34.1-34.1c4.7-4.7,4.7-12.3,0-17L147.912,363.325z"></path> <path d="M210.312,0.025h-197.1c-6.6,0-12,5.4-12,12v197.1c0,6.6,5.4,12,12,12h197.1c6.6,0,12-5.4,12-12v-197.1 C222.312,5.425,217.012,0.025,210.312,0.025z M198.312,197.125h-173.1v-173.1h173.1V197.125z"></path> <path d="M362.612,34.125h-55.2l13.6-13.6c4.7-4.7,4.7-12.3,0-17s-12.3-4.7-17,0l-34,34.1c-4.7,4.7-4.7,12.3,0,17l34.1,34.1 c2.3,2.3,5.4,3.5,8.5,3.5s6.1-1.2,8.5-3.5c4.7-4.7,4.7-12.3,0-17l-13.6-13.6h55.2c35.9,0,65,29.2,65,65v40.3c0,6.6,5.4,12,12,12 s12-5.4,12-12v-40.3C451.712,74.025,411.712,34.125,362.612,34.125z"></path> <path d="M438.812,428.025c-3.2,0-6.3,1.3-8.5,3.5s-3.5,5.3-3.5,8.5c0,3.1,1.3,6.3,3.5,8.5s5.3,3.5,8.5,3.5s6.3-1.3,8.5-3.5 s3.5-5.3,3.5-8.5s-1.3-6.3-3.5-8.5C445.012,429.325,441.912,428.025,438.812,428.025z"></path> <path d="M389.512,428.025c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S396.112,428.025,389.512,428.025z"></path> <path d="M290.912,428.025c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S297.612,428.025,290.912,428.025z"></path> <path d="M340.212,428.025c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S346.812,428.025,340.212,428.025z"></path> <path d="M241.713,428.025c-3.2,0-6.3,1.3-8.5,3.5s-3.5,5.3-3.5,8.5c0,3.1,1.3,6.3,3.5,8.5s5.3,3.5,8.5,3.5c3.1,0,6.3-1.3,8.5-3.5 s3.5-5.3,3.5-8.5s-1.3-6.3-3.5-8.5S244.812,428.025,241.713,428.025z"></path> <path d="M241.713,378.725c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S248.312,378.725,241.713,378.725z"></path> <path d="M241.713,329.425c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S248.312,329.425,241.713,329.425z"></path> <path d="M241.713,280.125c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S248.312,280.125,241.713,280.125z"></path> <path d="M241.713,230.925c-3.2,0-6.3,1.3-8.5,3.5s-3.5,5.3-3.5,8.5s1.3,6.3,3.5,8.5s5.3,3.5,8.5,3.5c3.1,0,6.3-1.3,8.5-3.5 s3.5-5.3,3.5-8.5c0-3.1-1.3-6.3-3.5-8.5C247.912,232.125,244.812,230.925,241.713,230.925z"></path> <path d="M389.512,230.925c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S396.112,230.925,389.512,230.925z"></path> <path d="M340.212,230.925c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S346.812,230.925,340.212,230.925z"></path> <path d="M290.912,230.925c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S297.612,230.925,290.912,230.925z"></path> <path d="M438.812,230.925c-3.2,0-6.3,1.3-8.5,3.5s-3.5,5.3-3.5,8.5s1.3,6.3,3.5,8.5s5.3,3.5,8.5,3.5s6.3-1.3,8.5-3.5 s3.5-5.3,3.5-8.5c0-3.1-1.3-6.3-3.5-8.5C445.012,232.225,441.912,230.925,438.812,230.925z"></path> <path d="M438.812,280.125c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S445.412,280.125,438.812,280.125z"></path> <path d="M438.812,378.725c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S445.412,378.725,438.812,378.725z"></path> <path d="M438.812,329.425c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S445.412,329.425,438.812,329.425z"></path></svg>
                </div>

            </div>
        </div>
        <div class="filters">
            <input type="search"
                   class="search-input small"
                   placeholder={bottomSearchPlaceholder}
                   value={bottomSearch}
                   oninput={handleBottomSearchInput}>
            <div class="checks">
                <lightning-input type="checkbox"
                                 label="Лише активовані"
                                 checked={filterEnabledOnly}
                                 onchange={handleFilterEnabledChange}>
                </lightning-input>
                <lightning-input type="checkbox"
                                 label="Лише неактивні"
                                 checked={filterDisabledOnly}
                                 onchange={handleFilterDisabledChange}>
                </lightning-input>
            </div>
        </div>
        <div class="list-container">

            <template if:true={hasBottomItems}>

                <!-- Група: Активовані -->
                <template if:true={hasActiveGroup}>
                    <div class="group-header">Активовані</div>
                    <template for:each={bottomActive} for:item="item">
                        <div key={item.id} class="row">
                            <div class="name">{item.name}</div>
                            <lightning-input type="toggle"
                                             checked={item.enabled}
                                             data-id={item.id}
                                             onchange={handleToggle}>
                            </lightning-input>
                        </div>
                    </template>
                </template>

                <!-- Група: Неактивні -->
                <template if:true={hasInactiveGroup}>
                    <div class="group-header">Неактивні</div>
                    <template for:each={bottomInactive} for:item="item">
                        <div key={item.id} class="row">
                            <div class="name">{item.name}</div>
                            <lightning-input type="toggle"
                                             checked={item.enabled}
                                             data-id={item.id}
                                             onchange={handleToggle}>
                            </lightning-input>
                        </div>
                    </template>
                </template>

            </template>

            <template if:false={hasBottomItems}>
                <div class="empty">Немає елементів для відображення.</div>
            </template>
        </div>

    </div>
</template>