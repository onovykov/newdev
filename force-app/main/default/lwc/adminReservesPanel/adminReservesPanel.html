<template>
    <div class="tab-header">
        <h1 class="tab-title">–ü–ª–∞–Ω –ø—Ä–∏–π–º–∞–Ω–Ω—è –±—Ä—É—Ö—Ç—É</h1>
        <p class="tab-subtitle">
            –¢—É—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è <b>–∑–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω—ñ —Å–ª–æ—Ç–∏</b> –Ω–∞ <b>–ø–æ—Ç–æ—á–Ω—É –¥–µ–∫–∞–¥—É</b>.
            –ö–æ–∂–µ–Ω –¥–µ–Ω—å –º–∞—î –∫–æ—Ä–æ—Ç–∫–µ –∑–≤–µ–¥–µ–Ω–Ω—è; –¥–µ—Ç–∞–ª—ñ –¥–ª—è –º–∏–Ω—É–ª–∏—Ö –¥–Ω—ñ–≤ –∑–≥–æ—Ä–Ω—É—Ç—ñ.
        </p>

    </div>

    <div class="orders-container">
        <template for:each={groupedData} for:item="group" for:index="index">
            <section key={group.date} class="orders-day-block">

                <!-- –ù–û–í–ò–ô –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–Ω—è -->
                <header class="day-head">
                    <div class="day-title">
                        <span class="day-chip" title="–î–µ–Ω—å —Ç–∏–∂–Ω—è">{group.dayLabel}</span>
                        <span class="date-chip" title="–î–∞—Ç–∞">{group.date}</span>
                    </div>
                    <!-- –æ–ø—Ü—ñ–π–Ω–æ: –∫–æ—Ä–æ—Ç–∫–∏–π –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∞–≤–æ—Ä—É—á -->
                    <div class="day-meta">
                        <span class="meta-item">
                            –°–ª–æ—Ç—ñ–≤: <b>{group.records.length}</b>
                        </span>
                    </div>
                </header>

                <!-- ‚úÖ Summary: –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î–º–æ -->
                <div class="summary-table-wrapper">
                    <table class="summary-table">
                        <thead>
                        <tr>
                            <th>–¢–∏–ø –±—Ä—É—Ö—Ç—É</th>
                            <th>–ó–∞–≥–∞–ª—å–Ω–∏–π —Ç–æ–Ω–Ω–∞–∂</th>
                            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤</th>
                        </tr>
                        </thead>
                        <tbody>
                        <template for:each={group.summary} for:item="s">
                            <tr key={s.scrapType}>
                                <td>{s.scrapType}</td>
                                <td>{s.totalTons} —Ç</td>
                                <td>{s.count}</td>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </div>

                <!-- üîò –ö–Ω–æ–ø–∫–∞ –ø—ñ–¥ summary -->
                <button class="accordion-btn"
                        data-index={index}
                        aria-expanded={group.open}
                        onclick={toggleSection}>
                    <template if:true={group.open}>‚ñ≤ –°—Ö–æ–≤–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ª–æ—Ç—ñ–≤</template>
                    <template if:false={group.open}>‚ñº –î–µ—Ç–∞–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ª–æ—Ç—ñ–≤</template>
                </button>

                <!-- üîΩ –î–µ—Ç–∞–ª—å–Ω—ñ —Å–ª–æ—Ç–∏ -->
                <template if:true={group.open}>
                    <div class="table-wrapper" style="margin-top: 1rem;">
                        <table class="orders-table">
                            <thead>
                            <tr>
                                <th>–ü–µ—Ä–µ–ø—É—Å—Ç–∫–∞</th>
                                <th>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</th>
                                <th>–¢–∏–ø –±—Ä—É—Ö—Ç—É</th>
                                <th>–ú–∞—à–∏–Ω–∞</th>
                                <th>–¢–æ–Ω–Ω–∞–∂</th>
                                <th>–í–æ–¥—ñ–π</th>
<!--                                <th>–ö–æ–Ω—Ç—Ä–∞–∫—Ç</th>-->
<!--                                <th>–ê–¥—Ä–µ—Å–∞</th>-->
                            </tr>
                            </thead>
                            <tbody>
                            <template for:each={group.records} for:item="res">
                                <tr key={res.id}
                                    data-id={res.id}
                                    data-pass={res.passNumber}
                                    data-supplier={res.supplier}
                                    data-type={res.scrapType}
                                    onclick={handleClick}>
                                    <td>{res.passNumber}</td>
                                    <td>{res.supplier}</td>
                                    <td>{res.scrapType}</td>
                                    <td>{res.truck}</td>
                                    <td>{res.tons}</td>
                                    <td>{res.driver}</td>
<!--                                    <td>{res.contract}</td>-->
<!--                                    <td>{res.address}</td>-->
                                </tr>
                            </template>
                            </tbody>
                        </table>
                    </div>
                </template>
            </section>
        </template>
    </div>
</template>